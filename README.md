# CreateAgriRefDatabase

In this repostitory there are classes and methods to create and access a database containing arigicultural reference data of multiple fields for bbch phases, sar data and optical data. This database can be used for AI applications.

### Table types
2 different tables can be created and accessed. The "field_day" (or "field_day_c") table and the "field" table (or "field_c"). 
Both tables are referenced by a hashed id system. 

### Id system

The field id (BIGINT) is generated by hashing a string as follows:

e.g.:

'origin: "ZEPP", geom: {polygon}, startdate: {startdate}, enddate: {enddate}, crop_type: {crop_type}, buff_distm: {buff_distm}, size: {area}'

Whereas:
* "origin" is the reference data provider
* "polygon" is the geojson polygon in EPSG 25832. 
* The "startdate" is either the first day of the year of the field border in format "yyyy-mm-dd" if this date is known, 
otherwise the value "0000-00-00", 
* The crop type is the crop type in accordance to the reference data, or in case of multiple crop types "diverse". 
* If a buffer has been extracted on the field borders in relevance to the polygon, buff_distm is the size in meters. 
* "size" contains the pre-calculated size of the field in sqm.
* The last 2 numbers of the id contain the year in format "yy" or "00"

### Use dump to copy a database
To copy a PostgreSQL database from a Linux machine to a Windows machine within a private network, you can use the `pg_dump` and `pg_restore` utilities provided by PostgreSQL. Here’s a step-by-step guide on how to do this:

### 1. Dump the Database on the Linux Machine
Use the `pg_dump` utility to create a backup of your database on the Linux machine.

1. **Open a terminal on your Linux machine.**
2. **Run the `pg_dump` command**:
    ```bash
    pg_dump -U your_db_user -h localhost -F c -b -v -f /path/to/your_db_name.backup your_db_name
    ```
    - Replace `your_db_user` with your PostgreSQL username.
    - Replace `/path/to/your_db_name.backup` with the path and filename where you want to save the backup file.
    - Replace `your_db_name` with the name of your database.

### 2. Transfer the Backup File to the Windows Machine
You can use tools like `scp`, `rsync`, or a USB drive to transfer the backup file.

#### Using `scp` (Secure Copy Protocol)
1. **On your Linux machine, run**:
    ```bash
    scp /path/to/your_db_name.backup your_windows_user@your_windows_machine_ip:C:\path\to\destination
    ```
    - Replace `your_windows_user` with your Windows username.
    - Replace `your_windows_machine_ip` with the IP address of your Windows machine.
    - Replace `C:\path\to\destination` with the destination path on your Windows machine.

#### Using `rsync`
1. **On your Linux machine, run**:
    ```bash
    rsync -avz /path/to/your_db_name.backup your_windows_user@your_windows_machine_ip:/cygdrive/c/path/to/destination
    ```
    - Note: For `rsync` to work on Windows, you need to have an `rsync` server running or use Cygwin.

#### Using a USB Drive
1. **Copy the backup file to a USB drive**.
2. **Plug the USB drive into your Windows machine and copy the file to the desired location**.

### 3. Restore the Database on the Windows Machine
Use the `pg_restore` utility to restore the database from the backup file on the Windows machine.

1. **Install PostgreSQL on your Windows machine** if it’s not already installed. You can download it from the [PostgreSQL website](https://www.postgresql.org/download/windows/).
2. **Open a command prompt on your Windows machine.**
3. **Run the `pg_restore` command**:
    ```sh
    pg_restore -U your_db_user -h localhost -d your_db_name -v C:\path\to\your_db_name.backup
    ```
    - Replace `your_db_user` with your PostgreSQL username.
    - Replace `your_db_name` with the name of the database you want to restore to (you may need to create the database first if it does not exist).
    - Replace `C:\path\to\your_db_name.backup` with the path to the backup file on your Windows machine.

### Additional Notes
- Ensure that the PostgreSQL service is running on your Windows machine before attempting the restore.
- If the database does not already exist on your Windows machine, you can create it using the `createdb` command:
    ```sh
    createdb -U your_db_user your_db_name
    ```
- Ensure that the PostgreSQL user you are using has the necessary privileges to create and restore databases.

By following these steps, you can successfully copy and restore your PostgreSQL database from a Linux machine to a Windows machine within a private network.